// Guddu-Project: Prisma Schema
// Enterprise Social Media Marketing Platform

generator client {
  provider = "prisma-client-js"
  previewFeatures = ["fullTextSearch", "postgresqlExtensions"]
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  extensions = [uuid_ossp(map: "uuid-ossp"), pgcrypto]
}

// ============================================
// ORGANIZATIONS & USERS
// ============================================

model Organization {
  id                   String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name                 String    @db.VarChar(255)
  slug                 String    @unique @db.VarChar(100)
  description          String?   @db.Text
  logoUrl              String?   @map("logo_url") @db.VarChar(500)
  website              String?   @db.VarChar(500)
  countryCode          String?   @map("country_code") @db.VarChar(3)
  timezone             String    @default("UTC") @db.VarChar(50)
  
  settings             Json      @default("{}")
  brandGuidelines      Json      @map("brand_guidelines") @default("{}")
  
  status               String    @default("active") @db.VarChar(20)
  subscriptionTier     String    @map("subscription_tier") @default("enterprise") @db.VarChar(20)
  subscriptionExpiresAt DateTime? @map("subscription_expires_at") @db.Timestamptz
  
  createdAt            DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt            DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz
  deletedAt            DateTime? @map("deleted_at") @db.Timestamptz
  
  users                User[]
  events               Event[]
  campaigns            Campaign[]
  content              Content[]
  mediaAssets          MediaAsset[] @relation("OrganizationMedia")
  contentTemplates     ContentTemplate[]
  socialAccounts       SocialAccount[]
  socialConnections    SocialConnection[]
  approvalWorkflows    ApprovalWorkflow[]
  auditLogs            AuditLog[]
  
  @@index([slug])
  @@index([status])
  @@map("organizations")
}

model User {
  id                   String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  organizationId       String    @map("organization_id") @db.Uuid
  
  email                String    @unique @db.VarChar(255)
  username             String?   @unique @db.VarChar(100)
  passwordHash         String?   @map("password_hash") @db.VarChar(255)
  
  firstName            String    @map("first_name") @db.VarChar(100)
  lastName             String    @map("last_name") @db.VarChar(100)
  avatarUrl            String?   @map("avatar_url") @db.VarChar(500)
  phone                String?   @db.VarChar(20)
  title                String?   @db.VarChar(100)
  department           String?   @db.VarChar(100)
  
  role                 String    @db.VarChar(50)
  permissions          Json      @default("[]")
  
  oauthProvider        String?   @map("oauth_provider") @db.VarChar(50)
  oauthId              String?   @map("oauth_id") @db.VarChar(255)
  
  preferences          Json      @default("{}")
  notificationSettings Json      @map("notification_settings") @default("{}")
  
  isActive             Boolean   @default(true) @map("is_active")
  isVerified           Boolean   @default(false) @map("is_verified")
  emailVerifiedAt      DateTime? @map("email_verified_at") @db.Timestamptz
  lastLoginAt          DateTime? @map("last_login_at") @db.Timestamptz
  lastLoginIp          String?   @map("last_login_ip")
  
  twoFactorEnabled     Boolean   @default(false) @map("two_factor_enabled")
  twoFactorSecret      String?   @map("two_factor_secret") @db.VarChar(255)
  
  createdAt            DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt            DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz
  deletedAt            DateTime? @map("deleted_at") @db.Timestamptz
  
  organization         Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  
  refreshTokens        RefreshToken[]
  socialConnections    SocialConnection[]
  createdEvents        Event[] @relation("EventCreator")
  createdCampaigns     Campaign[] @relation("CampaignCreator")
  createdContent       Content[] @relation("ContentCreator")
  updatedContent       Content[] @relation("ContentUpdater")
  approvedContent      Content[] @relation("ContentApprover")
  uploadedMedia        MediaAsset[] @relation("MediaUploader")
  connectedSocialAccounts SocialAccount[] @relation("SocialAccountConnector")
  approvalRequests     ApprovalRequest[] @relation("ApprovalRequester")
  approvalActions      ApprovalAction[] @relation("ApprovalActioner")
  notifications        Notification[]
  auditLogs            AuditLog[]
  
  @@index([organizationId])
  @@index([email])
  @@index([role])
  @@index([isActive])
  @@map("users")
}

model RefreshToken {
  id        String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  userId    String   @map("user_id") @db.Uuid
  token     String   @unique @db.VarChar(500)
  expiresAt DateTime @map("expires_at") @db.Timestamptz
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId])
  @@index([token])
  @@map("refresh_tokens")
}

// ============================================
// EVENTS & CAMPAIGNS
// ============================================

model Event {
  id                String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  organizationId    String    @map("organization_id") @db.Uuid
  
  name              String    @db.VarChar(255)
  slug              String    @db.VarChar(100)
  description       String?   @db.Text
  tagline           String?   @db.VarChar(500)
  
  startDate         DateTime  @map("start_date") @db.Timestamptz
  endDate           DateTime  @map("end_date") @db.Timestamptz
  timezone          String    @default("UTC") @db.VarChar(50)
  
  location          Json?
  
  logoUrl           String?   @map("logo_url") @db.VarChar(500)
  bannerUrl         String?   @map("banner_url") @db.VarChar(500)
  themeColors       Json?     @map("theme_colors")
  
  socialHandles     Json      @map("social_handles") @default("{}")
  officialHashtags  String[]  @map("official_hashtags")
  
  settings          Json      @default("{}")
  status            String    @default("planning") @db.VarChar(20)
  
  createdBy         String?   @map("created_by") @db.Uuid
  createdAt         DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt         DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz
  deletedAt         DateTime? @map("deleted_at") @db.Timestamptz
  
  organization      Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  creator           User?     @relation("EventCreator", fields: [createdBy], references: [id])
  
  phases            EventPhase[]
  delegates         Delegate[]
  campaigns         Campaign[]
  content           Content[]
  socialAccounts    SocialAccount[]
  sentimentAnalysis SentimentAnalysis[]
  
  @@unique([organizationId, slug])
  @@index([status])
  @@index([startDate, endDate])
  @@map("events")
}

model EventPhase {
  id          String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  eventId     String   @map("event_id") @db.Uuid
  
  name        String   @db.VarChar(100)
  description String?  @db.Text
  phaseType   String   @map("phase_type") @db.VarChar(20)
  
  startDate   DateTime @map("start_date") @db.Timestamptz
  endDate     DateTime @map("end_date") @db.Timestamptz
  
  goals       Json     @default("[]")
  kpis        Json     @default("[]")
  
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz
  
  event       Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  
  @@index([eventId])
  @@map("event_phases")
}

model Delegate {
  id               String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  eventId          String    @map("event_id") @db.Uuid
  
  title            String?   @db.VarChar(50)
  firstName        String    @map("first_name") @db.VarChar(100)
  lastName         String    @map("last_name") @db.VarChar(100)
  
  designation      String?   @db.VarChar(255)
  organizationName String?   @map("organization_name") @db.VarChar(255)
  country          String?   @db.VarChar(100)
  
  email            String?   @db.VarChar(255)
  phone            String?   @db.VarChar(20)
  photoUrl         String?   @map("photo_url") @db.VarChar(500)
  
  socialHandles    Json      @map("social_handles") @default("{}")
  
  delegateType     String?   @map("delegate_type") @db.VarChar(50)
  vipTier          Int       @default(3) @map("vip_tier")
  
  autoTag          Boolean   @default(false) @map("auto_tag")
  requiresApproval Boolean   @default(true) @map("requires_approval")
  
  bio              String?   @db.Text
  notes            String?   @db.Text
  
  createdAt        DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt        DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz
  
  event            Event     @relation(fields: [eventId], references: [id], onDelete: Cascade)
  
  @@index([eventId])
  @@index([delegateType])
  @@index([country])
  @@map("delegates")
}

model Campaign {
  id               String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  organizationId   String    @map("organization_id") @db.Uuid
  eventId          String?   @map("event_id") @db.Uuid
  
  name             String    @db.VarChar(255)
  slug             String    @db.VarChar(100)
  description      String?   @db.Text
  
  campaignType     String    @map("campaign_type") @db.VarChar(50)
  
  startDate        DateTime  @map("start_date") @db.Timestamptz
  endDate          DateTime  @map("end_date") @db.Timestamptz
  
  targetAudience   Json      @map("target_audience") @default("{}")
  targetPlatforms  String[]  @map("target_platforms")
  
  goals            Json      @default("[]")
  kpiTargets       Json      @map("kpi_targets") @default("{}")
  
  budgetAllocated  Decimal?  @map("budget_allocated") @db.Decimal(12, 2)
  budgetSpent      Decimal   @default(0) @map("budget_spent") @db.Decimal(12, 2)
  
  status           String    @default("draft") @db.VarChar(20)
  
  createdBy        String?   @map("created_by") @db.Uuid
  createdAt        DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt        DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz
  deletedAt        DateTime? @map("deleted_at") @db.Timestamptz
  
  organization     Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  event            Event?    @relation(fields: [eventId], references: [id], onDelete: SetNull)
  creator          User?     @relation("CampaignCreator", fields: [createdBy], references: [id])
  
  content          Content[]
  
  @@index([organizationId])
  @@index([eventId])
  @@index([status])
  @@map("campaigns")
}

// ============================================
// CONTENT & MEDIA
// ============================================

model Content {
  id                 String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  organizationId     String    @map("organization_id") @db.Uuid
  eventId            String?   @map("event_id") @db.Uuid
  campaignId         String?   @map("campaign_id") @db.Uuid
  
  contentType        String    @map("content_type") @db.VarChar(50)
  
  title              String?   @db.VarChar(500)
  body               String?   @db.Text
  caption            String?   @db.Text
  hashtags           String[]
  
  mediaAssets        String[]  @map("media_assets") @db.Uuid
  
  targetPlatforms    String[]  @map("target_platforms")
  platformVariants   Json      @map("platform_variants") @default("{}")
  
  scheduledFor       DateTime? @map("scheduled_for") @db.Timestamptz
  publishImmediately Boolean   @default(false) @map("publish_immediately")
  
  mentionedDelegates String[]  @map("mentioned_delegates") @db.Uuid
  tags               String[]
  
  workflowStatus     String    @default("draft") @map("workflow_status") @db.VarChar(30)
  
  approvalRequired   Boolean   @default(true) @map("approval_required")
  approvedBy         String?   @map("approved_by") @db.Uuid
  approvedAt         DateTime? @map("approved_at") @db.Timestamptz
  rejectionReason    String?   @map("rejection_reason") @db.Text
  
  version            Int       @default(1)
  parentVersionId    String?   @map("parent_version_id") @db.Uuid
  
  aiGenerated        Boolean   @default(false) @map("ai_generated")
  aiMetadata         Json      @map("ai_metadata") @default("{}")
  
  seoMetadata        Json      @map("seo_metadata") @default("{}")
  
  createdBy          String?   @map("created_by") @db.Uuid
  updatedBy          String?   @map("updated_by") @db.Uuid
  createdAt          DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt          DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz
  deletedAt          DateTime? @map("deleted_at") @db.Timestamptz
  
  organization       Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  event              Event?    @relation(fields: [eventId], references: [id], onDelete: SetNull)
  campaign           Campaign? @relation(fields: [campaignId], references: [id], onDelete: SetNull)
  creator            User?     @relation("ContentCreator", fields: [createdBy], references: [id])
  updater            User?     @relation("ContentUpdater", fields: [updatedBy], references: [id])
  approver           User?     @relation("ContentApprover", fields: [approvedBy], references: [id])
  parentVersion      Content?  @relation("ContentVersions", fields: [parentVersionId], references: [id])
  
  childVersions      Content[] @relation("ContentVersions")
  publishedPosts     PublishedPost[]
  approvalRequests   ApprovalRequest[]
  
  @@index([organizationId])
  @@index([eventId])
  @@index([campaignId])
  @@index([workflowStatus])
  @@index([scheduledFor])
  @@map("content")
}

model ContentTemplate {
  id            String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  organizationId String   @map("organization_id") @db.Uuid
  
  name          String   @db.VarChar(255)
  description   String?  @db.Text
  category      String?  @db.VarChar(100)
  
  contentType   String   @map("content_type") @db.VarChar(50)
  templateData  Json     @map("template_data")
  
  thumbnailUrl  String?  @map("thumbnail_url") @db.VarChar(500)
  
  isPublic      Boolean  @default(false) @map("is_public")
  usageCount    Int      @default(0) @map("usage_count")
  
  createdBy     String?  @map("created_by") @db.Uuid
  createdAt     DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt     DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz
  
  organization  Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  
  @@index([organizationId])
  @@index([category])
  @@map("content_templates")
}

model MediaAsset {
  id                String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  organizationId    String    @map("organization_id") @db.Uuid
  
  filename          String    @db.VarChar(255)
  originalFilename  String    @map("original_filename") @db.VarChar(255)
  fileType          String    @map("file_type") @db.VarChar(50)
  mimeType          String    @map("mime_type") @db.VarChar(100)
  fileSize          BigInt    @map("file_size")
  
  storageProvider   String    @default("s3") @map("storage_provider") @db.VarChar(50)
  storagePath       String    @map("storage_path") @db.VarChar(500)
  storageUrl        String    @map("storage_url") @db.VarChar(500)
  cdnUrl            String?   @map("cdn_url") @db.VarChar(500)
  
  width             Int?
  height            Int?
  duration          Int?
  metadata          Json      @default("{}")
  
  processingStatus  String    @default("pending") @map("processing_status") @db.VarChar(30)
  processedVariants Json      @map("processed_variants") @default("{}")
  
  aiTags            String[]  @map("ai_tags")
  aiDescription     String?   @map("ai_description") @db.Text
  aiAnalysis        Json      @map("ai_analysis") @default("{}")
  
  isPublic          Boolean   @default(false) @map("is_public")
  usageCount        Int       @default(0) @map("usage_count")
  
  uploadedBy        String?   @map("uploaded_by") @db.Uuid
  createdAt         DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt         DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz
  deletedAt         DateTime? @map("deleted_at") @db.Timestamptz
  
  organization      Organization @relation("OrganizationMedia", fields: [organizationId], references: [id], onDelete: Cascade)
  uploader          User?     @relation("MediaUploader", fields: [uploadedBy], references: [id])
  
  @@index([organizationId])
  @@index([fileType])
  @@index([processingStatus])
  @@map("media_assets")
}

// ============================================
// SOCIAL MEDIA
// ============================================

model SocialAccount {
  id              String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  organizationId  String    @map("organization_id") @db.Uuid
  eventId         String?   @map("event_id") @db.Uuid
  
  platform        String    @db.VarChar(50)
  accountType     String?   @map("account_type") @db.VarChar(50)
  
  platformUserId  String    @map("platform_user_id") @db.VarChar(255)
  username        String?   @db.VarChar(255)
  displayName     String?   @map("display_name") @db.VarChar(255)
  profileUrl      String?   @map("profile_url") @db.VarChar(500)
  avatarUrl       String?   @map("avatar_url") @db.VarChar(500)
  
  accessToken     String    @map("access_token") @db.Text
  refreshToken    String?   @map("refresh_token") @db.Text
  tokenExpiresAt  DateTime? @map("token_expires_at") @db.Timestamptz
  
  scopes          String[]
  
  isActive        Boolean   @default(true) @map("is_active")
  lastSyncAt      DateTime? @map("last_sync_at") @db.Timestamptz
  
  connectedBy     String?   @map("connected_by") @db.Uuid
  createdAt       DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt       DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz
  
  organization    Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  event           Event?    @relation(fields: [eventId], references: [id], onDelete: SetNull)
  connector       User?     @relation("SocialAccountConnector", fields: [connectedBy], references: [id])
  
  publishedPosts  PublishedPost[]
  
  @@unique([organizationId, platform, platformUserId])
  @@index([platform])
  @@map("social_accounts")
}

model PublishedPost {
  id                String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  contentId         String    @map("content_id") @db.Uuid
  socialAccountId   String    @map("social_account_id") @db.Uuid
  
  platform          String    @db.VarChar(50)
  platformPostId    String    @map("platform_post_id") @db.VarChar(255)
  platformUrl       String?   @map("platform_url") @db.VarChar(500)
  
  publishedContent  Json      @map("published_content")
  
  publishStatus     String    @default("pending") @map("publish_status") @db.VarChar(30)
  
  errorMessage      String?   @map("error_message") @db.Text
  retryCount        Int       @default(0) @map("retry_count")
  
  publishedAt       DateTime? @map("published_at") @db.Timestamptz
  createdAt         DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt         DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz
  
  content           Content   @relation(fields: [contentId], references: [id], onDelete: Cascade)
  socialAccount     SocialAccount @relation(fields: [socialAccountId], references: [id], onDelete: Cascade)
  
  engagementMetrics EngagementMetric[]
  sentimentAnalysis SentimentAnalysis[]
  
  @@index([contentId])
  @@index([socialAccountId])
  @@index([platform])
  @@index([publishStatus])
  @@map("published_posts")
}

// ============================================
// ANALYTICS
// ============================================

model EngagementMetric {
  id               String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  publishedPostId  String   @map("published_post_id") @db.Uuid
  
  platform         String   @db.VarChar(50)
  
  impressions      BigInt   @default(0)
  reach            BigInt   @default(0)
  likes            BigInt   @default(0)
  comments         BigInt   @default(0)
  shares           BigInt   @default(0)
  saves            BigInt   @default(0)
  clicks           BigInt   @default(0)
  videoViews       BigInt   @default(0) @map("video_views")
  
  engagementRate   Decimal? @map("engagement_rate") @db.Decimal(5, 2)
  
  platformMetrics  Json     @map("platform_metrics") @default("{}")
  
  measuredAt       DateTime @default(now()) @map("measured_at") @db.Timestamptz
  createdAt        DateTime @default(now()) @map("created_at") @db.Timestamptz
  
  publishedPost    PublishedPost @relation(fields: [publishedPostId], references: [id], onDelete: Cascade)
  
  @@index([publishedPostId])
  @@index([platform])
  @@index([measuredAt])
  @@map("engagement_metrics")
}

model SentimentAnalysis {
  id              String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  publishedPostId String?   @map("published_post_id") @db.Uuid
  eventId         String?   @map("event_id") @db.Uuid
  
  platform        String    @db.VarChar(50)
  textContent     String    @map("text_content") @db.Text
  authorUsername  String?   @map("author_username") @db.VarChar(255)
  
  sentiment       String    @db.VarChar(20)
  sentimentScore  Decimal?  @map("sentiment_score") @db.Decimal(3, 2)
  confidence      Decimal?  @db.Decimal(3, 2)
  
  entities        Json      @default("[]")
  keywords        String[]
  
  aiAnalysis      Json      @map("ai_analysis") @default("{}")
  
  analyzedAt      DateTime  @default(now()) @map("analyzed_at") @db.Timestamptz
  createdAt       DateTime  @default(now()) @map("created_at") @db.Timestamptz
  
  publishedPost   PublishedPost? @relation(fields: [publishedPostId], references: [id], onDelete: Cascade)
  event           Event?    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  
  @@index([publishedPostId])
  @@index([eventId])
  @@index([platform])
  @@index([sentiment])
  @@map("sentiment_analysis")
}

// ============================================
// WORKFLOWS
// ============================================

model ApprovalWorkflow {
  id                 String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  organizationId     String   @map("organization_id") @db.Uuid
  
  name               String   @db.VarChar(255)
  description        String?  @db.Text
  
  steps              Json
  triggerConditions  Json     @map("trigger_conditions") @default("{}")
  
  isActive           Boolean  @default(true) @map("is_active")
  
  createdAt          DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt          DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz
  
  organization       Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  
  approvalRequests   ApprovalRequest[]
  
  @@index([organizationId])
  @@map("approval_workflows")
}

model ApprovalRequest {
  id           String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  workflowId   String?   @map("workflow_id") @db.Uuid
  contentId    String    @map("content_id") @db.Uuid
  
  requestedBy  String    @map("requested_by") @db.Uuid
  currentStep  Int       @default(1) @map("current_step")
  
  status       String    @default("pending") @db.VarChar(30)
  comments     String?   @db.Text
  
  requestedAt  DateTime  @default(now()) @map("requested_at") @db.Timestamptz
  resolvedAt   DateTime? @map("resolved_at") @db.Timestamptz
  createdAt    DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt    DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz
  
  workflow     ApprovalWorkflow? @relation(fields: [workflowId], references: [id], onDelete: SetNull)
  content      Content   @relation(fields: [contentId], references: [id], onDelete: Cascade)
  requester    User      @relation("ApprovalRequester", fields: [requestedBy], references: [id])
  
  actions      ApprovalAction[]
  
  @@index([contentId])
  @@index([status])
  @@map("approval_requests")
}

model ApprovalAction {
  id                String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  approvalRequestId String   @map("approval_request_id") @db.Uuid
  
  stepNumber        Int      @map("step_number")
  action            String   @db.VarChar(20)
  
  actionedBy        String   @map("actioned_by") @db.Uuid
  comment           String?  @db.Text
  
  actionedAt        DateTime @default(now()) @map("actioned_at") @db.Timestamptz
  
  approvalRequest   ApprovalRequest @relation(fields: [approvalRequestId], references: [id], onDelete: Cascade)
  actioner          User     @relation("ApprovalActioner", fields: [actionedBy], references: [id])
  
  @@index([approvalRequestId])
  @@map("approval_actions")
}

// ============================================
// NOTIFICATIONS & AUDIT
// ============================================

model Notification {
  id         String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  userId     String    @map("user_id") @db.Uuid
  
  type       String    @db.VarChar(50)
  title      String    @db.VarChar(255)
  message    String    @db.Text
  actionUrl  String?   @map("action_url") @db.VarChar(500)
  
  metadata   Json      @default("{}")
  
  isRead     Boolean   @default(false) @map("is_read")
  readAt     DateTime? @map("read_at") @db.Timestamptz
  
  createdAt  DateTime  @default(now()) @map("created_at") @db.Timestamptz
  
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId])
  @@index([isRead])
  @@index([createdAt])
  @@map("notifications")
}

// ============================================
// SOCIAL MEDIA CONNECTIONS (User-Level)
// ============================================

model SocialConnection {
  id                  String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  userId              String    @map("user_id") @db.Uuid
  organizationId      String    @map("organization_id") @db.Uuid
  
  platform            String    @db.VarChar(50)
  accountType         String?   @map("account_type") @db.VarChar(50)
  
  platformUserId      String?   @map("platform_user_id") @db.VarChar(255)
  username            String?   @db.VarChar(255)
  displayName         String?   @map("display_name") @db.VarChar(255)
  profileUrl          String?   @map("profile_url") @db.VarChar(500)
  avatarUrl           String?   @map("avatar_url") @db.VarChar(500)
  
  accessToken         String    @map("access_token") @db.Text
  accessTokenSecret   String?   @map("access_token_secret") @db.Text
  refreshToken        String?   @map("refresh_token") @db.Text
  expiresAt           DateTime? @map("expires_at") @db.Timestamptz
  
  scopes              String[]  @default([])
  
  isActive            Boolean   @default(true) @map("is_active")
  lastUsedAt          DateTime? @map("last_used_at") @db.Timestamptz
  
  metadata            Json      @default("{}")
  
  createdAt           DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt           DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz
  
  user                User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  organization        Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  
  @@unique([userId, platform], name: "userId_platform")
  @@index([userId])
  @@index([platform])
  @@index([isActive])
  @@map("social_connections")
}

model AuditLog {
  id             String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  organizationId String?   @map("organization_id") @db.Uuid
  
  userId         String?   @map("user_id") @db.Uuid
  userEmail      String?   @map("user_email") @db.VarChar(255)
  
  action         String    @db.VarChar(100)
  entityType     String    @map("entity_type") @db.VarChar(50)
  entityId       String?   @map("entity_id") @db.Uuid
  
  changes        Json      @default("{}")
  metadata       Json      @default("{}")
  
  ipAddress      String?   @map("ip_address")
  userAgent      String?   @map("user_agent") @db.Text
  
  createdAt      DateTime  @default(now()) @map("created_at") @db.Timestamptz
  
  organization   Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user           User?     @relation(fields: [userId], references: [id], onDelete: SetNull)
  
  @@index([organizationId])
  @@index([userId])
  @@index([entityType, entityId])
  @@index([createdAt])
  @@map("audit_logs")
}

